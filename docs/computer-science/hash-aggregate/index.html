<!doctype html><html lang=en dir=ltr>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="This post is an expansion of this tweet:
If I had to pick a single programming concept where understanding it is like a superpower, it would probably be the hash map (aka in Python, the humble dictionary) because I've seen the pattern come up in almost every kind of data/programming work I've ever done.
&mdash; Vicki (*args,**kwargs) (@vboykis) July 8, 2020  Hash Aggregate Here #  But data work also has its own unique patterns, and I want to talk about one of these that I think is important for all of us to carry around in our back pockets: the humble hash aggregate.">
<meta name=theme-color content="#FFFFFF">
<meta name=color-scheme content="light dark"><meta property="og:title" content="Hash aggregates">
<meta property="og:description" content="This post is an expansion of this tweet:
If I had to pick a single programming concept where understanding it is like a superpower, it would probably be the hash map (aka in Python, the humble dictionary) because I've seen the pattern come up in almost every kind of data/programming work I've ever done.
&mdash; Vicki (*args,**kwargs) (@vboykis) July 8, 2020  Hash Aggregate Here #  But data work also has its own unique patterns, and I want to talk about one of these that I think is important for all of us to carry around in our back pockets: the humble hash aggregate.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://boringml.com/docs/computer-science/hash-aggregate/"><meta property="article:section" content="docs">
<meta property="article:modified_time" content="2021-12-29T15:41:33-05:00">
<title>Hash aggregates | Boring Machine Learning</title>
<link rel=manifest href=/manifest.json>
<link rel=icon href=/favicon.png type=image/x-icon>
<link rel=stylesheet href=/book.min.46181bc93375ba932026e753b37c40e6ff8bb16a9ef770c78bcc663e4577b1ba.css integrity="sha256-RhgbyTN1upMgJudTs3xA5v+LsWqe93DHi8xmPkV3sbo=" crossorigin=anonymous>
<script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.64465ed3fe966d091d308affe9c27729002dbd0ca799ae6f43c3be2910f16e66.js integrity="sha256-ZEZe0/6WbQkdMIr/6cJ3KQAtvQynma5vQ8O+KRDxbmY=" crossorigin=anonymous></script>
</head>
<body dir=ltr>
<input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control>
<main class="container flex">
<aside class=book-menu>
<div class=book-menu-content>
<nav>
<h2 class=book-brand>
<a class="flex align-center" href=/><img src=/logo.png alt=Logo><span>Boring Machine Learning</span>
</a>
</h2>
<div class=book-search>
<input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/>
<div class="book-search-spinner hidden"></div>
<ul id=book-search-results></ul>
</div>
<ul>
<li>
<input type=checkbox id=section-d41e3b1e7be18fdedcdd8781529c68cd class=toggle>
<label for=section-d41e3b1e7be18fdedcdd8781529c68cd class="flex justify-between">
<a href=http://boringml.com/docs/php/>Php</a>
</label>
<ul>
<li>
<a href=http://boringml.com/docs/php/arrays/>is_set</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-dbec22d72f9c0b4ccf9d173e77fe928c class=toggle>
<label for=section-dbec22d72f9c0b4ccf9d173e77fe928c class="flex justify-between">
<a href=http://boringml.com/docs/python/>Python</a>
</label>
<ul>
<li>
<a href=http://boringml.com/docs/python/strptime/>strptime and strftime</a>
</li>
<li>
<a href=http://boringml.com/docs/python/venv/>venv</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-3c4b9ad27a844def3e7d21cf2decb606 class=toggle>
<label for=section-3c4b9ad27a844def3e7d21cf2decb606 class="flex justify-between">
<a href=http://boringml.com/docs/recsys/>Recsys</a>
</label>
<ul>
<li>
<a href=http://boringml.com/docs/recsys/jaccard-similarity/>Jaccard Similarity</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-38bb35919265222d517dd5f8edf2719a class=toggle>
<label for=section-38bb35919265222d517dd5f8edf2719a class="flex justify-between">
<a href=http://boringml.com/docs/scala/>Scala</a>
</label>
<ul>
<li>
<a href=http://boringml.com/docs/scala/post1/>Scalding</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-e6b75252305a86840411664cb2e84e9c class=toggle>
<label for=section-e6b75252305a86840411664cb2e84e9c class="flex justify-between">
<a href=http://boringml.com/docs/sql/>SQL</a>
</label>
<ul>
<li>
<a href=http://boringml.com/docs/sql/arrays/>Legible SQL</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-8524f085204099c73bb397c727f0b9fd class=toggle checked>
<label for=section-8524f085204099c73bb397c727f0b9fd class="flex justify-between">
<a role=button>Computer Science</a>
</label>
<ul>
<li>
<a href=http://boringml.com/docs/computer-science/hash-aggregate/ class=active>Hash aggregates</a>
</li>
</ul>
</li>
<li>
<input type=checkbox id=section-26e813df4c1d2ae66edc7adef58c4759 class=toggle>
<label for=section-26e813df4c1d2ae66edc7adef58c4759 class="flex justify-between">
<a role=button>Frameworks</a>
</label>
<ul>
<li>
<a href=http://boringml.com/docs/frameworks/airflow/>Airflow</a>
</li>
<li>
<a href=http://boringml.com/docs/frameworks/aws/>Aws</a>
</li>
<li>
<a href=http://boringml.com/docs/frameworks/kubernetes/>Kubernetes</a>
</li>
<li class=book-section-flat>
<span>Spark</span>
<ul>
<li>
<a href=http://boringml.com/docs/frameworks/spark/create-data-python/>Sample data in PySpark</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<script>(function(){var a=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>
</div>
</aside>
<div class=book-page>
<header class=book-header>
<div class="flex align-center justify-between">
<label for=menu-control>
<img src=/svg/menu.svg class=book-icon alt=Menu>
</label>
<strong>Hash aggregates</strong>
<label for=toc-control>
</label>
</div>
</header>
<article class=markdown><figure><img src=https://raw.githubusercontent.com/veekaybee/veekaybee.github.io/master/static/images/checkers.png width=300px>
</figure>
<p>This post is an expansion of this tweet:</p>
<blockquote class=twitter-tweet><p lang=en dir=ltr>If I had to pick a single programming concept where understanding it is like a superpower, it would probably be the hash map (aka in Python, the humble dictionary) because I've seen the pattern come up in almost every kind of data/programming work I've ever done.</p>&mdash; Vicki (*args,**kwargs) (@vboykis) <a href="https://twitter.com/vboykis/status/1280911880157093888?ref_src=twsrc%5Etfw">July 8, 2020</a></blockquote>
<script async src=https://platform.twitter.com/widgets.js></script>
<h2 id=hash-aggregate-here>
Hash Aggregate Here
<a class=anchor href=#hash-aggregate-here>#</a>
</h2>
<p>But data work also has its own unique patterns, and I want to talk about one of these that I think is important for all of us to carry around in our back pockets: the humble hash aggregate. The hash aggregate <a href=https://jakevdp.github.io/blog/2017/03/22/group-by-from-scratch/>works like this</a>:</p>
<figure><img src=https://raw.githubusercontent.com/veekaybee/veekaybee.github.io/master/static/images/split-apply-combine.png width=600px>
</figure>
<p>You have a multidimensional array (or, as us plebes say, table) that contains numerous instances of similar labels. What you want to know is the distinct counts of each category. The implemented algorithm splits the matrix by key and sums the values and then returns the reduced matrix that has only unique keys and the sum values to the user.</p>
<p>It&rsquo;s a very simple and ingenious algorithm, and it shows up over and over and over again. If you&rsquo;ve ever done a GROUP BY statement in SQL, you&rsquo;ve used the hash aggregate function. Python&rsquo;s dictionary operations utilize hash aggregates. And so does Pandas' split-apply-combine (pictured here from Jake&rsquo;s great post) And, so does Excel&rsquo;s <a href=https://en.wikipedia.org/wiki/Pivot_table>Pivot table function</a>. So does <code>sort filename | uniq -c | sort -nr</code> in Unix. So does the map/reduce pattern that started in Hadoop, <a href=https://www.xplenty.com/blog/apache-spark-vs-hadoop-mapreduce/>and has been implemented in-memory in Spark. </a> An <a href=https://en.wikipedia.org/wiki/Inverted_index>inverted index</a>, the foundation for Elasticsearch (and many search and retrieval platforms) is a hash aggregate.</p>
<h2 id=so-what>
So what?
<a class=anchor href=#so-what>#</a>
</h2>
<p>If you&rsquo;ve worked with either development or data for any length of time, it&rsquo;s almost guaranteed that you&rsquo;ve come across the need to get unique categories of things and then count the things in those categories. In some cases, you might need to build your own implementation of GROUP BY because it doesn&rsquo;t work in your language or framework of choice.</p>
<p>My personal opinion is that every data-centric framework that&rsquo;s been around long enough tends to SQL, so everything will <a href=https://docs.confluent.io/5.2.0/ksql/docs/developer-guide/aggregate-streaming-data.html>eventually implement hash aggregation.</a></p>
<p>Once you understand that hash aggregation is a common pattern, it makes sense to observe it at work, learn more about how to optimize it, and generally think about it.</p>
<p>Once we know that this pattern has a name and exists, we have a sense of power over our data work. Confuscius (or whoever attributed the quote to him) once said, â€œThe beginning of wisdom is to call things by their proper name," and either he was once a curious toddler, or an MLE looking to better understand the history and context of his architecture.</p>
</article>
<footer class=book-footer>
<div class="flex flex-wrap justify-between">
<div><a class="flex align-center" href=https://github.com/veekaybee/boringml/commit/dee6518ac213ef9f8c5a7b9cb9c182d55ca94531 title="Last modified by Vicki | Dec 29, 2021" target=_blank rel=noopener>
<img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>Dec 29, 2021</span>
</a>
</div>
</div>
<script>(function(){function a(c){const a=window.getSelection(),b=document.createRange();b.selectNodeContents(c),a.removeAllRanges(),a.addRange(b)}document.querySelectorAll("pre code").forEach(b=>{b.addEventListener("click",function(c){a(b.parentElement),navigator.clipboard&&navigator.clipboard.writeText(b.parentElement.textContent)})})})()</script>
</footer>
<div class=book-comments>
</div>
<label for=menu-control class="hidden book-menu-overlay"></label>
</div>
</main>
</body>
</html>